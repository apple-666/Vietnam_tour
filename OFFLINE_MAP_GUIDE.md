# 离线地图使用指南 🗺️

本指南说明如何下载和使用胡志明市旅游助手的离线地图功能。

---

## 📋 目录

1. [什么是离线地图](#什么是离线地图)
2. [离线地图的优势](#离线地图的优势)
3. [下载离线地图](#下载离线地图)
4. [使用离线地图](#使用离线地图)
5. [常见问题](#常见问题)

---

## 什么是离线地图

离线地图是指将地图瓦片（图片文件）提前下载到本地，使用时直接从本地读取，无需从互联网加载。

**工作原理**：
- 正常模式：地图瓦片从 `https://tile.openstreetmap.org` 实时下载
- 离线模式：地图瓦片从本地 `docs/tiles/` 目录读取

**自动回退机制**：
如果本地瓦片不存在，系统会自动使用在线备用服务器，确保地图始终可用。

---

## 离线地图的优势

### ✅ 国内访问速度优化
- **问题**：OpenStreetMap 服务器在海外，国内访问较慢
- **解决**：本地瓦片加载速度快，无需翻墙

### ✅ 完全离线使用
- 无需网络连接即可查看地图
- 适合在飞机、酒店等网络不稳定的环境使用

### ✅ 减少流量消耗
- 离线地图已下载到本地，不消耗流量
- 每次浏览都使用缓存的瓦片

### ✅ 提升移动端体验
- Android/iOS 设备加载速度更快
- 减少地图加载等待时间

---

## 下载离线地图

### 方法一：使用 Python 脚本（推荐）

#### 1. 安装依赖

```bash
pip install requests
```

#### 2. 运行下载脚本

```bash
python download_tiles.py
```

#### 3. 等待下载完成

脚本会显示：
- 需要下载的瓦片数量
- 预估下载大小
- 下载进度

**预计数据量**：
- 缩放级别 10-15：约 5-15 MB
- 下载时间：取决于网络速度（通常 5-15 分钟）

#### 4. 验证下载

下载完成后，检查 `docs/tiles/` 目录：
```
docs/
└── tiles/
    ├── 10/
    │   ├── 500/
    │   │   ├── 300.png
    │   │   ├── 301.png
    │   │   └── ...
    ├── 11/
    ├── 12/
    ├── 13/
    ├── 14/
    └── 15/
```

---

### 方法二：手动下载（不推荐）

1. 访问 [OpenStreetMap 瓦片服务器](https://tile.openstreetmap.org/)
2. 手动下载所需瓦片
3. 按照以下目录结构放置：
   ```
   tiles/{z}/{x}/{y}.png
   ```
4. 其中：
   - `{z}` = 缩放级别 (10-15)
   - `{x}` = X 坐标
   - `{y}` = Y 坐标

---

## 使用离线地图

### 自动检测

离线地图功能已集成到 `app.js` 中，使用时：

1. **打开网页**：直接打开 `docs/index.html`
2. **自动检测**：系统会自动检测本地瓦片是否存在
3. **优先使用本地**：如果本地有瓦片，优先使用本地
4. **自动回退**：如果本地没有，自动使用在线服务器

### 控制台日志

打开浏览器开发者工具（F12），可以看到：

**成功使用离线地图**：
```
🗺️ 初始化地图（离线瓦片支持）...
✅ 地图瓦片加载完成
🎉 完全离线模式！所有瓦片均来自本地
```

**部分使用在线备用**：
```
🗺️ 初始化地图（离线瓦片支持）...
🌐 本地瓦片 13/500/300 不存在，使用在线备用
✅ 地图瓦片加载完成
💡 120 个瓦片使用在线备用服务器
```

### 测试离线功能

1. 打开 `docs/index.html`
2. 按 F12 打开开发者工具
3. 切换到 Console 标签
4. 查看地图加载日志
5. 如果看到 "🎉 完全离线模式"，说明离线地图已成功

---

## 常见问题

### Q1: 离线地图能覆盖多大范围？

**A**: 当前配置覆盖：
- **纬度**：10.30°N ~ 10.85°N
- **经度**：106.30°E ~ 106.75°E
- **缩放**：10-15 级

覆盖范围：
- ✅ 胡志明市中心
- ✅ 所有景点（粉红教堂、古邮局、总统府等）
- ✅ 美拖市（湄公河三角洲）
- ✅ 新山一国际机场

### Q2: 离线地图文件多大？

**A**: 取决于缩放级别：
- 缩放 10-13：约 5 MB
- 缩放 10-15：约 15 MB

### Q3: 需要多长时间下载？

**A**: 取决于网络速度：
- 国内网络：10-20 分钟
- 国外网络：5-10 分钟

### Q4: 离线地图会过期吗？

**A**: OpenStreetMap 数据会不断更新，但：
- 地图道路等基础信息变化不大
- 建议每 6-12 个月重新下载一次
- 无需担心，即使过期也会自动使用在线备用

### Q5: 如何更新离线地图？

**A**:
1. 删除旧的 `docs/tiles/` 目录
2. 重新运行 `python download_tiles.py`
3. 刷新浏览器即可

### Q6: 可以只在手机上使用离线地图吗？

**A**: 可以，但需要：
1. 在电脑上下载离线地图
2. 将 `docs/tiles/` 目录复制到手机
3. 确保手机浏览器可以访问本地文件
4. 推荐使用支持本地文件的浏览器（如 Chrome）

### Q7: 离线地图在 GitHub Pages 上能用吗？

**A**:
- ✅ 可以！将 `tiles/` 目录上传到 GitHub
- ✅ 访问 `https://apple-666.github.io/Vietnam_tour/docs/` 时会自动使用本地瓦片
- ⚠️ 注意：GitHub Pages 有 100MB 单文件限制，但整个仓库无限制

### Q8: 没有下载离线地图会影响使用吗？

**A**:
- ❌ 不会！系统会自动使用在线服务器
- ✅ 离线地图是**可选的增强功能**
- ✅ 没有离线地图，网站依然完全可用

---

## 技术说明

### 瓦片下载脚本配置

文件：`download_tiles.py`

关键参数：
```python
# 地图范围（胡志明市）
MIN_LAT = 10.30   # 南边界
MAX_LAT = 10.85   # 北边界
MIN_LON = 106.30  # 西边界
MAX_LON = 106.75  # 东边界

# 缩放级别
MIN_ZOOM = 10     # 最小缩放（整个城市）
MAX_ZOOM = 15     # 最大缩放（街道细节）
```

### app.js 离线地图配置

```javascript
const localTilesPath = 'tiles';  // 本地瓦片目录
const maxLocalZoom = 15;         // 最大本地缩放级别
```

---

## 推荐工作流程

### 开发环境
```bash
# 1. 下载离线地图
python download_tiles.py

# 2. 启动本地服务器
python -m http.server 8000

# 3. 访问网站
http://localhost:8000/docs/
```

### 部署到 GitHub Pages
```bash
# 1. 确保离线地图已下载
ls docs/tiles/10/500/300.png

# 2. 提交到 Git
git add docs/tiles/
git commit -m "添加离线地图瓦片"
git push
```

---

## 总结

离线地图是一个**可选的增强功能**，具有以下特点：

✅ **优点**：
- 国内访问速度更快
- 完全离线也能使用
- 减少流量消耗
- 提升移动端体验

❌ **缺点**：
- 需要提前下载（5-15 MB）
- 首次配置需要时间
- 地图可能不是最新的

💡 **建议**：
- 如果主要在国内使用：**强烈推荐下载**
- 如果网络环境良好：可选下载
- 如果只是临时查看：无需下载

---

**祝您旅途愉快！** 🎒✈️🇻🇳
