# 越南旅游助手 - 测试指南

## 📋 测试前准备

### 已完成的工作 ✅

1. ✅ **瓦片下载**: 1892/1892 (100%) 完整
2. ✅ **地图范围**: 激进优化方案（景点范围 + 1-2km 缓冲）
3. ✅ **缩放级别**: 10-15 级全覆盖
4. ✅ **离线支持**: 已配置本地瓦片优先，在线备用

---

## 🗺️ 可用的测试页面

### 1. 离线地图测试页面（推荐首先测试）

**文件路径**: `docs/offline_test.html`

**功能**:
- 测试本地瓦片是否正常工作
- 显示本地/在线瓦片统计
- 显示工作模式（完全离线/混合/在线）

**测试方法**:
```
1. 在浏览器中打开:
   file:///D:/apple/workspace/Vietnam_tour/docs/offline_test.html

2. 检查顶部状态栏:
   - 本地瓦片: 应显示 > 1500
   - 在线备用: 应显示 0 或接近 0
   - 工作模式: 应显示 "🎉 完全离线"

3. 检查控制台（F12）:
   - 应显示 "✅ 地图加载完成"
   - 应显示瓦片统计信息

4. 测试缩放:
   - 滚动鼠标缩放地图
   - 检查各级别瓦片是否正常显示
```

**预期结果**:
```
✅ 地图正常显示胡志明市中心
✅ 状态显示: 本地瓦片 > 1500, 在线备用 = 0
✅ 工作模式: 🎉 完全离线
✅ 缩放功能正常（级别 10-15）
```

---

### 2. 主应用 - 在线版本

**文件路径**: `docs/index.html`

**当前配置**: 使用在线 OpenStreetMap 瓦片

**功能**:
- 完整的旅游助手功能
- 航班、酒店、景点信息
- 快速定位、路线显示
- 货币换算、时间显示
- 点赞、浏览统计

**测试方法**:
```
1. 在浏览器中打开:
   file:///D:/apple/workspace/Vietnam_tour/docs/index.html

2. 检查地图是否正常显示

3. 测试快速定位功能:
   - 点击"📍 快速定位"下拉框
   - 选择任意地点（机场/酒店/景点）
   - 地图应自动移动到该位置并打开弹窗

4. 测试路线显示:
   - 点击"🛤️ 显示路线"按钮
   - 检查是否显示游览路线

5. 测试侧边栏:
   - 检查航班信息
   - 检查酒店信息
   - 检查行程概览
   - 检查详细时间表

6. 测试货币换算:
   - 在"越南盾"输入框输入金额
   - 检查"人民币"是否自动计算

7. 测试点赞功能:
   - 点击"⭐ 点赞"按钮
   - 点赞数应增加
```

**预期结果**:
```
✅ 地图正常显示
✅ 所有标记可点击
✅ 快速定位功能正常
✅ 路线显示功能正常
✅ 侧边栏信息完整
✅ 货币换算功能正常
✅ 点赞功能正常
```

---

### 3. 主应用 - 离线版本（需要手动切换）

**配置方法**:

编辑 `docs/index.html`，找到第 155 行:
```html
<script src="app.js"></script>
```

修改为:
```html
<script src="app_offline.js"></script>
```

**优点**:
- 优先使用本地瓦片（速度快）
- 本地瓦片缺失时自动使用在线备用
- 支持完全离线使用

**测试方法**: 同在线版本测试步骤

**预期结果**:
```
✅ 所有功能正常
✅ 控制台显示"🎉 完全离线模式"
✅ 地图加载速度快
```

---

## 📱 移动端测试

### 测试方法

1. **使用浏览器开发者工具**:
   ```
   1. 按 F12 打开开发者工具
   2. 点击"设备模拟"图标（Ctrl+Shift+M）
   3. 选择设备（iPhone 12 / Samsung Galaxy 等）
   4. 刷新页面测试
   ```

2. **使用真实手机**:
   ```
   1. 确保手机和电脑在同一 WiFi
   2. 在电脑上启动 HTTP 服务器:
      cd D:\apple\workspace\Vietnam_tour\docs
      python -m http.server 8000
   3. 在手机浏览器访问:
      http://电脑IP:8000/index.html
   ```

### 检查项目

| 检查项 | 预期结果 |
|--------|----------|
| 地图显示 | 正常显示，无灰块 |
| 侧边栏 | 可正常滚动 |
| 快速定位 | 下拉框可用 |
| 标记点击 | 弹窗正常显示 |
| 响应式 | 布局自适应 |

---

## 🔍 功能详细测试清单

### 地图功能

- [ ] 地图初始化正常
- [ ] 缩放功能正常（滚轮或按钮）
- [ ] 拖拽平移正常
- [ ] 酒店标记显示（红色🏨）
- [ ] 景点标记显示（蓝色/绿色/橙色/紫色数字）
- [ ] 机场标记显示（深灰色✈️）
- [ ] 点击标记显示弹窗
- [ ] 弹窗内容完整

### 快速定位

- [ ] 下拉框显示所有地点
- [ ] 分组正确（机场/酒店/景点）
- [ ] 选择后地图自动移动
- [ ] 自动打开弹窗
- [ ] 缩放级别合适

### 路线显示

- [ ] 点击"显示路线"按钮
- [ ] 路线线条显示
- [ ] 路线颜色与天数对应
- [ ] 再次点击可隐藏

### 侧边栏信息

- [ ] 航班信息完整
- [ ] 酒店信息完整
- [ ] 行程概览正确
- [ ] 详细时间表完整
- [ ] 重要提示显示
- [ ] 紧急联系方式正确
- [ ] 汇率信息显示

### 头部功能

- [ ] 上海时间显示
- [ ] 胡志明时间显示
- [ ] 货币换算器工作
- [ ] 浏览量显示（756）
- [ ] 点赞功能工作
- [ ] PDF下载链接正确

### 离线功能

- [ ] offline_test.html 正常工作
- [ ] 状态显示"完全离线"
- [ ] 本地瓦片 > 1500
- [ ] 在线备用 = 0
- [ ] 断网仍可使用（离线版本）

---

## 🐛 常见问题

### Q1: 地图显示灰色方块

**原因**: 本地瓦片不完整或在线服务器连接失败

**解决方案**:
1. 检查 `docs/tiles/` 目录是否有瓦片文件
2. 检查浏览器控制台是否有错误
3. 尝试刷新页面

### Q2: 快速定位不工作

**原因**: JavaScript 错误或 ID 匹配问题

**解决方案**:
1. 打开浏览器控制台（F12）
2. 查看是否有错误信息
3. 检查 `focusLocation` 函数是否正确

### Q3: 离线模式无法使用

**原因**: Leaflet JS 库需要联网加载

**解决方案**:
- 首次加载需要联网（Leaflet 库从 CDN 加载）
- 后续可断网使用瓦片（如需完全离线，需下载 Leaflet 库到本地）

### Q4: 移动端地图不显示

**原因**: Android 设备兼容性问题

**解决方案**:
- 已在 `app_offline.js` 中添加移动端优化选项
- 使用 Canvas 渲染提高兼容性
- 增加30秒超时时间

---

## ✅ 测试完成标准

### 基础功能（必须）

- [x] 地图正常显示
- [x] 所有标记可见且可点击
- [x] 快速定位功能正常
- [x] 侧边栏信息完整
- [x] 离线测试页面显示"完全离线"

### 高级功能（推荐）

- [ ] 路线显示功能正常
- [ ] 货币换算功能正常
- [ ] 点赞功能正常
- [ ] 移动端显示正常
- [ ] 离线版本可用

---

## 📊 测试结果记录

**测试日期**: 2026-01-22
**测试人**: Double Apple (小鹏)
**瓦片状态**: ✅ 1892/1892 (100%)

| 页面 | 状态 | 备注 |
|------|------|------|
| offline_test.html | ⏳ 待测试 |  |
| index.html (在线版) | ⏳ 待测试 |  |
| index.html (离线版) | ⏳ 待测试 | 需切换JS文件 |

---

## 🚀 快速测试命令

### 1. 启动 HTTP 服务器

```bash
cd D:\apple\workspace\Vietnam_tour\docs
python -m http.server 8000
```

### 2. 访问页面

- 离线测试: http://localhost:8000/offline_test.html
- 主应用: http://localhost:8000/index.html

### 3. 检查瓦片完整性

```bash
cd D:\apple\workspace\Vietnam_tour
python -c "import os; print('瓦片总数:', sum(len(files) for _, _, files in os.walk('docs/tiles')))"
```

---

**测试完成后，请将结果记录到本文档的"测试结果记录"部分。**
