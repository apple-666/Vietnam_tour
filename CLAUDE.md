# Claude 开发指南 - 胡志明市旅游助手项目

## 🤖 基本规则

1. **语言**: 始终使用中文与用户交流
2. **版本控制**: 始终不用 git 指令
3. **决策**: 当存在多种有效方法时，始终先提出澄清问题
4. **编码**: 文件编码都为 UTF-8，执行文件过程中有任何编码乱码问题请提前解决掉
5. **注释**: 重点代码都有对应相关的中文注释

---

## 📁 项目结构

```
Vietnam_tour/
├── data/
│   └── data.js              # 核心数据文件（酒店、景点、行程等）
├── src/
│   ├── index.html           # 主页面入口
│   ├── app.js               # 应用主逻辑
│   └── style.css            # 样式文件
├── out/
│   └── out_v1.png           # 网站预览图
├── docs/                    # 文档目录
├── tests/                   # 测试文件
├── README.md                # 项目说明文档
└── CLAUDE.md                # 本文件（Claude 开发指南）
```

---

## 🎯 核心功能模块

### 1. 地图系统 (Leaflet.js)
- 地图初始化
- 标记点管理（机场、酒店、景点）
- 路线绘制
- 弹窗显示

### 2. 数据管理
- 所有数据存储在 `data/data.js`
- 数据包含：航班、酒店、景点、行程、提示、联系方式
- 数据版本追踪机制

### 3. 用户交互
- 快速定位功能
- 行程时间表切换
- 路线显示/隐藏
- 响应式侧边栏

---

## ⚠️ 重要：已知问题与解决方案

### 问题 1: 快速定位功能显示 "location not found"
**症状**: 选择任何地点都显示找不到位置

**根本原因**: `focusLocation()` 函数中 `split('-', 2)` 导致 ID 被截断

**位置**: `src/app.js` 第 529 行

**错误代码**:
```javascript
const parts = value.split('-', 2);  // ❌ 只分割成2部分
const id = parts[1];  // 例如："attr" 而不是 "attr-1"
```

**正确代码**:
```javascript
const parts = value.split('-');  // ✅ 分割成所有部分
const id = parts.slice(1).join('-');  // ✅ 正确重组 ID
```

**修复日期**: 2026-01-21

---

## 🛠️ 常见任务指南

### 任务 1: 更新旅游数据

**步骤**:
1. 读取 `data/data.js`
2. 修改相应数据（添加景点、更新酒店信息等）
3. 更新 `DATA_VERSION` 和 `DATA_LAST_UPDATED`
4. 提示用户刷新浏览器

**注意事项**:
- 确保 ID 格式一致（如 `"attr-1"`, `"hotel-1"`）
- 新增景点必须包含必需字段：`id`, `name`, `lat`, `lng`, `day`, `duration`
- 保持 JSON 格式正确

### 任务 2: 添加新功能

**步骤**:
1. 先提出澄清问题确认需求
2. 读取相关文件了解现有实现
3. 修改代码并添加中文注释
4. 测试功能是否正常
5. 更新 README.md（如需要）

### 任务 3: 修复 Bug

**步骤**:
1. 询问用户具体症状
2. 使用 Grep 工具搜索相关代码
3. 读取相关文件分析问题
4. 提出修复方案供用户确认
5. 实施修复并添加注释

### 任务 4: 数据可视化

**地图标记颜色规范**:
- 第 1 天景点: 蓝色 `#1E88E5`
- 第 2 天景点: 绿色 `#43A047`
- 第 3 天景点: 橙色 `#FB8C00`
- 第 4 天景点: 紫色 `#8E24AA`
- 酒店: 红色 `#E53935`
- 机场: 深灰色 `#424242`

**路线颜色**: 与对应天数的标记颜色一致

---

## 📝 代码规范

### JavaScript 规范
- 使用 ES6+ 语法
- 函数命名：驼峰式（如 `focusLocation`）
- 常量命名：大写下划线（如 `DATA_VERSION`）
- 添加中文注释说明复杂逻辑

### HTML 规范
- 使用语义化标签
- 保持适当的缩进
- 注释说明功能区块

### CSS 规范
- 使用类选择器
- 避免内联样式
- 响应式设计优先

---

## 🧪 测试检查清单

修改代码后，请检查：
- [ ] 地图是否正常加载
- [ ] 所有标记是否正确显示
- [ ] 点击标记是否显示弹窗
- [ ] 快速定位功能是否工作
- [ ] 行程路线是否正确显示
- [ ] 侧边栏是否正常切换
- [ ] 移动端显示是否正常

---

## 🔄 版本历史

### v1.0 (2026-01-21)
- ✅ 基础地图功能
- ✅ 4天行程展示
- ✅ 快速定位功能
- 🔧 修复 focusLocation ID 解析 bug

---

## 🚀 第二阶段开发计划

### 待实现功能
1. **后端 API 开发**
   - 用户点赞接口
   - 点赞数据统计接口
   - CORS 配置

2. **前端改造**
   - 添加点赞按钮
   - 集成 API 调用
   - 显示点赞数量

3. **数据持久化**
   - 选择数据库方案
   - 设计数据表结构
   - 实现数据存储逻辑

4. **部署准备**
   - 选择托管平台
   - 配置域名和 SSL
   - 性能优化

---

## 💬 用户常见问题

**Q: 数据更新后页面没变化？**
A: 提示用户按 F5 或 Ctrl+R 刷新页面

**Q: 如何添加新景点？**
A: 在 `data/data.js` 的 `tourData.attractions` 数组中添加对象

**Q: 地图不显示？**
A: 检查网络连接，地图需要从互联网加载 OpenStreetMap

**Q: 快速定位不工作？**
A: 检查 `src/app.js` 第 529 行的 split 方法是否正确

---

## 📚 相关文档

- [README.md](README.md) - 项目说明
- [DATA_UPDATE_GUIDE.md](DATA_UPDATE_GUIDE.md) - 数据更新指南
- [package.json](package.json) - 项目依赖（如存在）

---

**最后更新**: 2026-01-21
**维护者**: Claude Sonnet 4.5